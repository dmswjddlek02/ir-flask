<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>IR 보고서 추천</title>
  <script>
let columnNames = [];

document.addEventListener("DOMContentLoaded", () => {
  const searchInput = document.getElementById("search");
  const resultDiv = document.getElementById("result");
  const reportDiv = document.getElementById("report");

  // ✅ 1. 실시간 컬럼 받아오기
  fetch('/columns')
    .then(res => res.json())
    .then(data => {
      columnNames = data.columns || [];
    });

  // ✅ 2. 검색 기능
  searchInput.addEventListener("input", () => {
    const keyword = searchInput.value.trim();
    const matches = columnNames.filter(col => col.includes(keyword));

    if (matches.length > 0) {
      resultDiv.innerHTML = "<ul>" + matches.map(m => {
        return `<li style="cursor: pointer; color: blue;" onclick="document.getElementById('search').value='${m}'; document.getElementById('search').dispatchEvent(new Event('input'));">📌 ${m}</li>`;
      }).join("") + "</ul>";
    } else {
      resultDiv.innerHTML = "❌ 일치하는 컬럼이 없어요.";
    }

    const matchedReports = reportRules.filter(rule =>
      rule.required.every(req => columnNames.includes(req))
    );

    if (matchedReports.length > 0) {
      reportDiv.innerHTML = "<strong>📄 추천 가능한 보고서:</strong><ul>" +
        matchedReports.map(r => `<li>✅ ${r.name}</li>`).join("") +
        "</ul>";
    } else {
      reportDiv.innerHTML = "📝 조건에 맞는 보고서가 없습니다.";
    }
  });
});
</script>

</head>
<body style="padding: 2rem; font-family: Arial;">
  <h1 style="font-size: 24px;">🔍 IR 컬럼 검색 & 보고서 추천</h1>

  <input type="text" id="search" placeholder="검색어를 입력하세요 (예: 충원율)"
         style="width: 100%; padding: 10px; font-size: 16px; margin-top: 10px;" />

  <div id="result" style="margin-top: 20px; font-size: 18px;"></div>
  <hr style="margin: 20px 0;">
  <div id="report" style="font-size: 18px; color: green;"></div>
</body>
</html>
