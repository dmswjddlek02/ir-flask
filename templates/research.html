<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>IR ë³´ê³ ì„œ ì¶”ì²œ</title>
  <script>
let columnNames = [];

document.addEventListener("DOMContentLoaded", () => {
  const searchInput = document.getElementById("search");
  const resultDiv = document.getElementById("result");
  const reportDiv = document.getElementById("report");

  // âœ… 1. ì‹¤ì‹œê°„ ì»¬ëŸ¼ ë°›ì•„ì˜¤ê¸°
  fetch('/columns')
    .then(res => res.json())
    .then(data => {
      columnNames = data.columns || [];
    });

  // âœ… 2. ê²€ìƒ‰ ê¸°ëŠ¥
  searchInput.addEventListener("input", () => {
    const keyword = searchInput.value.trim();
    const matches = columnNames.filter(col => col.includes(keyword));

    if (matches.length > 0) {
      resultDiv.innerHTML = "<ul>" + matches.map(m => {
        return `<li style="cursor: pointer; color: blue;" onclick="document.getElementById('search').value='${m}'; document.getElementById('search').dispatchEvent(new Event('input'));">ğŸ“Œ ${m}</li>`;
      }).join("") + "</ul>";
    } else {
      resultDiv.innerHTML = "âŒ ì¼ì¹˜í•˜ëŠ” ì»¬ëŸ¼ì´ ì—†ì–´ìš”.";
    }

    const matchedReports = reportRules.filter(rule =>
      rule.required.every(req => columnNames.includes(req))
    );

    if (matchedReports.length > 0) {
      reportDiv.innerHTML = "<strong>ğŸ“„ ì¶”ì²œ ê°€ëŠ¥í•œ ë³´ê³ ì„œ:</strong><ul>" +
        matchedReports.map(r => `<li>âœ… ${r.name}</li>`).join("") +
        "</ul>";
    } else {
      reportDiv.innerHTML = "ğŸ“ ì¡°ê±´ì— ë§ëŠ” ë³´ê³ ì„œê°€ ì—†ìŠµë‹ˆë‹¤.";
    }
  });
});
</script>

</head>
<body style="padding: 2rem; font-family: Arial;">
  <h1 style="font-size: 24px;">ğŸ” IR ì»¬ëŸ¼ ê²€ìƒ‰ & ë³´ê³ ì„œ ì¶”ì²œ</h1>

  <input type="text" id="search" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì¶©ì›ìœ¨)"
         style="width: 100%; padding: 10px; font-size: 16px; margin-top: 10px;" />

  <div id="result" style="margin-top: 20px; font-size: 18px;"></div>
  <hr style="margin: 20px 0;">
  <div id="report" style="font-size: 18px; color: green;"></div>
</body>
</html>
